{{ 'shop-by-videos.css' | asset_url | stylesheet_tag }}
<script src="{{ 'shop-by-videos.js' | asset_url }}" defer="defer"></script>

<div class="shop-by-videos">
  {% if section.settings.heading != blank %}
    <h2 class="shop-by-videos__heading">{{ section.settings.heading }}</h2>
  {% endif %}

  <div class="shop-by-videos__track">
    {%- comment -%} Duplicate blocks twice for seamless GSAP infinite scroll {%- endcomment -%}
    {% for i in (1..2) %}
      <div class="shop-by-videos__group" aria-hidden="{% if i == 2 %}true{% else %}false{% endif %}">
        {% for block in section.blocks %}
          <div class="shop-by-videos__card" {{ block.shopify_attributes }}>

            <div class="shop-by-videos__media">
              {% if block.settings.video != blank %}
                {{ block.settings.video | video_tag: autoplay: true, loop: true, muted: true, controls: false, playsinline: true, class: 'shop-by-videos__video'
                }}
              {% elsif block.settings.video_url != blank %}
                <iframe
                  src="{{ block.settings.video_url }}"
                  class="shop-by-videos__video shop-by-videos__video--iframe"
                  allow="autoplay; loop"
                  allowfullscreen
                  loading="lazy"></iframe>
              {% else %}
                {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg shop-by-videos__placeholder' }}
              {% endif %}
            </div>

            {% if block.settings.product != blank %}
              {% assign product = block.settings.product %}
              <div class="shop-by-videos__product">
                {% if product.featured_image != blank %}
                  <div class="shop-by-videos__product-image">
                    {{ product.featured_image | image_url: width: 100 | image_tag: alt: product.featured_image.alt | default: product.title, loading: 'lazy', width: 100, height: 100
                    }}
                  </div>
                {% endif %}

                <div class="shop-by-videos__product-info">
                  <a href="{{ product.url }}" class="shop-by-videos__product-title">
                    {{ product.title }}
                  </a>

                  <div class="shop-by-videos__product-price">
                    {% if product.compare_at_price > product.price %}
                      <span class="shop-by-videos__price shop-by-videos__price--sale">
                        {{ product.price | money }}
                      </span>
                      <s class="shop-by-videos__price shop-by-videos__price--compare">
                        {{ product.compare_at_price | money }}
                      </s>
                    {% else %}
                      <span class="shop-by-videos__price">
                        {{ product.price | money }}
                      </span>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endif %}

          </div>
        {% endfor %}
      </div>
    {% endfor %}
  </div>
</div>

{% schema %}
  {
    "name": "Shop By Videos",
    "tag": "section",
    "class": "shop-by-videos-section",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "Shop By Videos"
      }
    ],
    "blocks": [
      {
        "type": "video",
        "name": "Video Card",
        "settings": [
          {
            "type": "video",
            "id": "video",
            "label": "Video (Shopify-hosted)"
          },
          {
            "type": "url",
            "id": "video_url",
            "label": "External Video URL",
            "info": "Used as fallback if no Shopify-hosted video is set"
          },
          {
            "type": "product",
            "id": "product",
            "label": "Product"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Shop By Videos",
        "blocks": [
          {
            "type": "video"
          },
          {
            "type": "video"
          },
          {
            "type": "video"
          }
        ]
      }
    ]
  }
{% endschema %}