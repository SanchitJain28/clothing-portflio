{{ 'section-testimonial-carousel.css' | asset_url | stylesheet_tag }}

<div class="testimonial-carousel" data-section-id="{{ section.id }}">
  <div class="page-width">
    <div class="testimonial-carousel__header">
      <h2 class="testimonial-carousel__title">{{ section.settings.heading }}</h2>

      {% if section.settings.show_rating %}
        <div class="testimonial-carousel__rating">
          <div class="testimonial-carousel__stars">
            {% for i in (1..5) %}
              <svg
                class="star-icon{% if i <= section.settings.rating_value %} filled{% else %} half{% endif %}"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none">
                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="currentColor" />
              </svg>
            {% endfor %}
          </div>
          {% if section.settings.review_count != blank %}
            <p class="testimonial-carousel__review-count">from {{ section.settings.review_count }} reviews</p>
          {% endif %}
        </div>
      {% endif %}
    </div>

    <div class="testimonial-carousel__wrapper">
      <div class="testimonial-carousel__track">
        {% for block in section.blocks %}
          <div class="testimonial-carousel__slide" {{ block.shopify_attributes }}>
            <div class="testimonial-card">
              <!-- Column 1: Author + Stars -->
              <div class="testimonial-card__author">
                <p class="testimonial-card__name">{{ block.settings.author_name }}</p>
                <div class="testimonial-card__stars">
                  {% for i in (1..5) %}
                    <svg
                      class="star-icon filled"
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none">
                      <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="currentColor" />
                    </svg>
                  {% endfor %}
                </div>
              </div>

              <!-- Column 2: Review title + text -->
              <div class="testimonial-card__review-body">
                {% if block.settings.review_title != blank %}
                  <h3 class="testimonial-card__title">{{ block.settings.review_title }}</h3>
                {% endif %}
                <p class="testimonial-card__text">{{ block.settings.review_text }}</p>
              </div>

              <!-- Column 3: Image -->
              {% if block.settings.review_image != blank %}
                <div class="testimonial-card__image">
                  {% if block.settings.badge_text != blank %}
                    <div class="testimonial-card__badge">
                      {{ block.settings.badge_text }}
                    </div>
                  {% endif %}
                  <img
                    src="{{ block.settings.review_image | image_url: width: 600 }}"
                    alt="{{ block.settings.author_name }} review"
                    width="400"
                    height="400"
                    loading="lazy">
                </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>

      {% if section.blocks.size > 1 %}
        <div class="testimonial-carousel__controls">
          <button class="testimonial-carousel__nav testimonial-carousel__nav--prev" aria-label="Previous review">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none">
              <path
                d="M15 18L9 12L15 6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </button>

          <div class="testimonial-carousel__dots"></div>

          <button class="testimonial-carousel__nav testimonial-carousel__nav--next" aria-label="Next review">
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none">
              <path
                d="M9 18L15 12L9 6"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </button>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script src="{{ 'section-testimonial-carousel.js' | asset_url }}" defer="defer"></script>

{% schema %}
  {
    "name": "Testimonial Carousel",
    "tag": "section",
    "class": "section",
    "settings": [
      {
        "type": "text",
        "id": "heading",
        "label": "Heading",
        "default": "HEAR IT FROM OUR KICA CHICAS!"
      },
      {
        "type": "checkbox",
        "id": "show_rating",
        "label": "Show overall rating",
        "default": true
      },
      {
        "type": "range",
        "id": "rating_value",
        "min": 1,
        "max": 5,
        "step": 0.5,
        "default": 4.5,
        "label": "Rating value"
      },
      {
        "type": "text",
        "id": "review_count",
        "label": "Review count",
        "default": "1590"
      },
      {
        "type": "checkbox",
        "id": "autoplay",
        "label": "Auto-rotate slides",
        "default": true
      },
      {
        "type": "range",
        "id": "autoplay_speed",
        "min": 3,
        "max": 10,
        "step": 1,
        "default": 5,
        "label": "Auto-rotate speed (seconds)"
      },
      {
        "type": "header",
        "content": "Spacing"
      },
      {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "Padding top",
        "default": 52
      },
      {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 100,
        "step": 4,
        "unit": "px",
        "label": "Padding bottom",
        "default": 52
      }
    ],
    "blocks": [
      {
        "type": "testimonial",
        "name": "Testimonial",
        "settings": [
          {
            "type": "text",
            "id": "author_name",
            "label": "Author name",
            "default": "Sarah M."
          },
          {
            "type": "text",
            "id": "review_title",
            "label": "Review title",
            "default": "Love it"
          },
          {
            "type": "textarea",
            "id": "review_text",
            "label": "Review text",
            "default": "Omg the material and stretch is so damn good. I was worried about the camel toe but it turns out so good I don't have to worry about it anymore ðŸ˜Š love it so much. Thank you ðŸ˜Š"
          },
          {
            "type": "image_picker",
            "id": "review_image",
            "label": "Review image"
          },
          {
            "type": "text",
            "id": "badge_text",
            "label": "Badge text (optional)",
            "info": "e.g., 'SCULPTING KICKASSâ„¢ FABRIC'"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "Testimonial Carousel",
        "blocks": [
          {
            "type": "testimonial"
          },
          {
            "type": "testimonial"
          },
          {
            "type": "testimonial"
          }
        ]
      }
    ]
  }
{% endschema %}